var saasbackendErrorTrackingEmbed=(()=>{function m(a){let t={initialized:!1,config:{endpoint:"/api/log/error",headers:{},getAuthHeader:null,maxErrorsPerSession:50,debounceMs:1e3,sampleRatePercent:100,...a||{}},errorCount:0,lastErrorTime:0,lastErrorFingerprint:"",originalFetch:null};function w(){return Math.floor(Math.random()*100)}function p(){let e=Number(t.config.sampleRatePercent);return!Number.isFinite(e)||e>=100?!0:e<=0?!1:w()<e}function s(e,r,n){return`${e||""}|${String(r||"").slice(0,120)}|${n||""}`}function f(e){if(!p())return!1;let r=Date.now();return t.errorCount>=t.config.maxErrorsPerSession||e===t.lastErrorFingerprint&&r-t.lastErrorTime<t.config.debounceMs?!1:(t.lastErrorFingerprint=e,t.lastErrorTime=r,t.errorCount+=1,!0)}function u(){let e="";try{let r=document.querySelector('meta[name="app-version"]');e=r&&r.content?r.content:""}catch{e=""}return{url:window.location.href,referrer:document.referrer||"",viewport:`${window.innerWidth}x${window.innerHeight}`,locale:navigator.language||"",appVersion:e}}function k(){let e={...t.config.headers||{}},r=t.config.getAuthHeader;if(typeof r=="function")try{let n=r();n&&(e.authorization=n)}catch{}return e}function d(e){try{let r=t.config.endpoint||"/api/log/error",n=k();if(navigator.sendBeacon)try{let o=new Blob([JSON.stringify(e)],{type:"application/json"});if(navigator.sendBeacon(r,o))return}catch{}let i=new XMLHttpRequest;i.open("POST",r,!0),i.setRequestHeader("Content-Type","application/json"),Object.keys(n||{}).forEach(o=>{n[o]!=null&&i.setRequestHeader(o,String(n[o]))}),i.send(JSON.stringify(e))}catch{}}function y(e){if(e instanceof Error)return{errorName:e.name||"UnhandledRejection",message:e.message,stack:e.stack||""};if(typeof e=="string")return{errorName:"UnhandledRejection",message:e,stack:""};try{return{errorName:"UnhandledRejection",message:JSON.stringify(e),stack:""}}catch{return{errorName:"UnhandledRejection",message:String(e),stack:""}}}function E(e,r,n,i,o){let c=o&&o.name||"Error",l=o&&o.message||e||"Unknown error",g=o&&o.stack||"",R=s(c,l,r||window.location.href);f(R)&&d({severity:"error",errorName:c,message:l,stack:g,url:r||window.location.href,runtime:u(),extra:{lineno:n,colno:i}})}function b(e){let r=y(e&&e.reason),n=s(r.errorName,r.message,window.location.href);f(n)&&d({severity:"error",errorName:r.errorName,message:r.message,stack:r.stack,url:window.location.href,runtime:u()})}function T(){t.originalFetch||typeof window.fetch!="function"||(t.originalFetch=window.fetch,window.fetch=function(e,r){return t.originalFetch.apply(this,arguments).then(n=>{try{if(n&&n.status>=500){let i=typeof e=="string"?e:e&&e.url||"",o=r&&r.method||"GET",c=s("FetchError",`${n.status} ${i}`,i);f(c)&&d({severity:"warn",errorName:"FetchError",message:`HTTP ${n.status} on ${o} ${i}`,request:{method:o,path:i,statusCode:n.status},runtime:u()})}}catch{}return n}).catch(n=>{try{let i=typeof e=="string"?e:e&&e.url||"",o=r&&r.method||"GET",c=n&&n.message||String(n),l=n&&n.stack||"",g=s("FetchError",c,i);f(g)&&d({severity:"error",errorName:"FetchError",message:c,stack:l,request:{method:o,path:i},runtime:u()})}catch{}throw n})})}function F(e){t.initialized||(e&&h(e),window.addEventListener("error",r=>{E(r&&r.message,r&&r.filename,r&&r.lineno,r&&r.colno,r&&r.error)}),window.addEventListener("unhandledrejection",b),T(),t.initialized=!0)}function h(e){!e||typeof e!="object"||(t.config={...t.config,...e,headers:{...t.config.headers||{},...e.headers||{}}})}function N(e,r){let n=e&&e.name||"CustomError",i=e&&e.message||String(e),o=e&&e.stack||"",c=s(n,i,window.location.href);f(c)&&d({severity:"error",errorName:n,message:i,stack:o,url:window.location.href,runtime:u(),extra:r})}function S(){if(t.initialized){try{window.fetch=t.originalFetch||window.fetch,t.originalFetch=null}catch{}t.initialized=!1}}return{init:F,config:h,report:N,teardown:S}}function j(){let a=typeof window<"u"?window:void 0;a&&(a.saasbackend=a.saasbackend||{},a.saasbackend.errorTracking||(a.saasbackend.errorTracking=m()),a.saasbackend.errorTracking&&typeof a.saasbackend.errorTracking.init=="function"&&a.saasbackend.errorTracking.init())}j();})();
