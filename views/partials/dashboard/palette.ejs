<!-- Command Palette Component -->
<div v-if="showPalette" class="fixed inset-0 z-[100] flex items-start justify-center pt-[15vh] px-4">
  <!-- Backdrop -->
  <div class="fixed inset-0 bg-gray-900/50 backdrop-blur-sm" @click.stop="closePalette('backdrop-click')" @mousedown.stop></div>
  
  <!-- Palette Modal -->
  <div class="relative w-full max-w-2xl bg-white rounded-xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col"
       @click.stop 
       @mousedown.stop>
    <!-- Input -->
    <div class="relative flex items-center px-4 py-4 border-b border-gray-200">
      <i class="ti ti-search text-gray-400 text-xl mr-3"></i>
      <input 
        ref="paletteInput"
        v-model="paletteQuery"
        type="text"
        placeholder="Search modules... (↑↓ to navigate, Enter to select, Esc to close)"
        class="flex-1 bg-transparent border-none focus:ring-0 text-lg text-gray-800"
        @keydown.down.prevent="navigatePalette(1)"
        @keydown.up.prevent="navigatePalette(-1)"
        @keydown.enter.prevent="selectPaletteItem"
        @keydown.esc="closePalette('escape-key')"
      >
      <div class="flex items-center gap-1 ml-4">
        <kbd class="px-2 py-1 bg-gray-100 border border-gray-300 rounded text-xs text-gray-500 font-sans">ESC</kbd>
      </div>
    </div>

    <!-- Results -->
    <div class="max-height-[50vh] overflow-y-auto py-2">
      <div v-if="filteredModules.length === 0" class="px-6 py-10 text-center text-gray-500">
        <i class="ti ti-search-off text-4xl mb-2 opacity-20"></i>
        <p>No modules found matching "{{ paletteQuery }}"</p>
      </div>
      
      <div v-else>
        <button
          v-for="(item, index) in filteredModules"
          :key="item.id"
          ref="resultItems"
          @click="selectModule(item)"
          @mouseover="paletteCursor = index"
          :class="['w-full flex items-center px-6 py-3 text-left transition-colors', paletteCursor === index ? 'bg-blue-50 text-blue-700' : 'text-gray-700 hover:bg-gray-50']"
        >
          <i :class="['ti mr-4 text-xl', item.icon, paletteCursor === index ? 'text-blue-600' : 'text-gray-400']"></i>
          <div class="flex-1">
            <div class="font-medium">{{ item.label }}</div>
            <div class="text-xs opacity-60">{{ item.sectionTitle }}</div>
          </div>
          <i v-if="paletteCursor === index" class="ti ti-corner-down-left text-blue-400"></i>
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 flex items-center justify-between text-[11px] text-gray-400">
      <div class="flex gap-4">
        <span><kbd class="bg-white border rounded px-1.5 py-0.5">↑↓</kbd> Navigate</span>
        <span><kbd class="bg-white border rounded px-1.5 py-0.5">Enter</kbd> Select</span>
        <span><kbd class="bg-white border rounded px-1.5 py-0.5">Esc</kbd> Close</span>
      </div>
      <div>SuperBackend <span class="text-[10px] font-normal opacity-60 ml-1">(@intranefr/superbackend)</span></div>
    </div>
  </div>
</div>
